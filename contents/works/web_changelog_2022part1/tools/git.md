## Git 2.35 zdiff3
　コンフリクトが発生したときのマージ競合マーカーのモード (merge.conflictStyle) として、zdiff3が追加されました。zdiff3はdiff3の強化版でより正確で簡素な競合マーカーを示します[^git_235]。

　はじめに、diff3の説明をしつつ、zdiff3で何が変わったのか説明します。まず、コンフリクトを起こすための準備として、branchAにファイルを作成し、以下の文章を書くとします。

```
# branchA
読書の習慣を作る
```

　その後、branchAからbranchBを作り、以下の修正をコミットします。

```
# branchB
先ず大切なことは
読書の習慣を作るということである。
習慣が実に多くのことを為すのである。
```

　そして、branchAに戻り、以下の修正をコミットします (読書を運動に変えました)。

```
# branchA
先ず大切なことは
運動の習慣を作るということである。
習慣が実に多くのことを為すのである。
```

　最後に、branchAにbranchBをマージすると、コンフリクトが発生します。diff3だとこのようになります。`|||||||` から `=======` までは、コンフリクト箇所の共通の祖先を表しています。以下のマーカーから、共通の祖先に対し、HEADとbranchBで何を修正したかがそれぞれ分かります。

```
# branchA
<<<<<<< HEAD
先ず大切なことは
運動の習慣を作るということである。
習慣が実に多くのことを為すのである。
||||||| c5ddf53
読書の習慣を作る
=======
先ず大切なことは
読書の習慣を作るということである。
習慣が実に多くのことを為すのである。
>>>>>>> branchB
```

<div style="page-break-after: always; break-after: page;"></div>

　しかしdiff3を使用すると、マージされる側とマージする側で同じ要素が含まれている場合 (上の例では`先ず大切なことは`と`習慣が実に多くのことを為すのである。`が同じ要素) でも、それぞれ差分が表示されてしまいます。

　zdiff3を使うと、以下のように共通部分を外に出して差分を表示してくれます。ちなみに以下では、branchBで「xxを作るということである」という文章を追加し、HEADで読書を運動に置き換えたんだなというのが分かりやすく表示されています。

```
# branchA
先ず大切なことは
<<<<<<< HEAD
運動の習慣を作るということである。
||||||| c5ddf53
読書の習慣を作る
=======
読書の習慣を作るということである。
>>>>>>> branchB
習慣が実に多くのことを為すのである。
```

[^git_235]: [https://github.blog/2022-01-24-highlights-from-git-2-35/](https://github.blog/2022-01-24-highlights-from-git-2-35/)
